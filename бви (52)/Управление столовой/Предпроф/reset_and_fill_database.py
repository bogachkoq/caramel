import sqlite3
import os
from datetime import datetime
from werkzeug.security import generate_password_hash

DB_NAME = "canteen_full.db"

print("=" * 60)
print("üîÑ –°–ë–†–û–° –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–•")
print("=" * 60)

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –±–∞–∑—É –µ—Å–ª–∏ –µ—Å—Ç—å
if os.path.exists(DB_NAME):
    os.remove(DB_NAME)
    print("‚úÖ –°—Ç–∞—Ä–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–¥–∞–ª–µ–Ω–∞")

# –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –±–∞–∑—É
conn = sqlite3.connect(DB_NAME)
cursor = conn.cursor()

print("‚úÖ –ù–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞")

# ===== –°–û–ó–î–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶ =====
cursor.execute('''CREATE TABLE users (
    username TEXT PRIMARY KEY, 
    password TEXT, 
    fullName TEXT, 
    role TEXT, 
    school TEXT, 
    grade TEXT, 
    phone TEXT, 
    email TEXT, 
    balance REAL DEFAULT 0, 
    allergies TEXT DEFAULT '', 
    isApproved INTEGER DEFAULT 1,
    cardNumber TEXT DEFAULT '',
    cardHolder TEXT DEFAULT '',
    cardExpiry TEXT DEFAULT '')''')

cursor.execute('''CREATE TABLE menu (
    id INTEGER PRIMARY KEY AUTOINCREMENT, 
    name TEXT, 
    price REAL, 
    portions INTEGER, 
    type TEXT,
    ingredients TEXT DEFAULT '',
    category TEXT DEFAULT '–û–±–µ–¥',
    addedDate TEXT)''')

cursor.execute('''CREATE TABLE orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT, 
    user TEXT, 
    name TEXT, 
    price REAL, 
    status TEXT, 
    allergies TEXT, 
    issuedAt TEXT, 
    createdAt TEXT)''')

cursor.execute('''CREATE TABLE ingredients (
    id INTEGER PRIMARY KEY AUTOINCREMENT, 
    name TEXT, 
    amount REAL, 
    unit TEXT)''')

cursor.execute('''CREATE TABLE reviews (
    dish TEXT, 
    text TEXT, 
    author TEXT)''')

cursor.execute('''CREATE TABLE purchases (
    id INTEGER PRIMARY KEY AUTOINCREMENT, 
    item TEXT, 
    qty TEXT,
    price REAL DEFAULT 0,
    status TEXT)''')

cursor.execute('''CREATE TABLE notifications (
    title TEXT, 
    text TEXT, 
    type TEXT, 
    toUser TEXT, 
    toRole TEXT, 
    time TEXT)''')

cursor.execute('''CREATE TABLE sub_transactions (
    user TEXT, 
    type TEXT, 
    amount REAL, 
    time TEXT)''')

cursor.execute('''CREATE TABLE subscription_usage (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user TEXT,
    subType TEXT,
    date TEXT,
    dishesUsed TEXT,
    createdAt TEXT)''')

print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã")

# ===== –¢–ï–°–¢–û–í–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò (–ü–ê–†–û–õ–¨ 123 –î–õ–Ø –í–°–ï–•) =====
now = datetime.now().isoformat()

users = [
    # –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω
    ('admin', generate_password_hash('123'), '–ì–ª–∞–≤–Ω—ã–π –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'admin', '–°–∏—Å—Ç–µ–º–∞', '', '', '', 0, '', 1, '', '',
     ''),

    # –£—á–µ–Ω–∏–∫
    ('a', generate_password_hash('123'), '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', 'student', '–ì–ë–û–£ –®–∫–æ–ª–∞ ‚Ññ656', '9–ê', '+7 999 111-11-11',
     'student@school.ru', 1000, '', 1, '', '', ''),

    # –ü–æ–≤–∞—Ä
    ('aa', generate_password_hash('123'), '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞', 'chef', '–ì–ë–û–£ –®–∫–æ–ª–∞ ‚Ññ656', '', '+7 999 222-22-22',
     'chef@school.ru', 0, '', 1, '', '', ''),

    # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
    ('aaa', generate_password_hash('123'), '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –°–∏–¥–æ—Ä–æ–≤', 'admin', '–ì–ë–û–£ –®–∫–æ–ª–∞ ‚Ññ656', '', '+7 999 333-33-33',
     'admin1@school.ru', 0, '', 1, '', '', '')
]

for user in users:
    cursor.execute("INSERT INTO users VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?)", user)
    print(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω: {user[0]:6} ({user[3]:8}) | –ü–∞—Ä–æ–ª—å: 123")

# ===== –¢–ï–°–¢–û–í–´–ï –ë–õ–Æ–î–ê =====
test_dishes = [
    # –ó–∞–≤—Ç—Ä–∞–∫–∏
    ("–ö–∞—à–∞ –æ–≤—Å—è–Ω–∞—è —Å –º–∞—Å–ª–æ–º", 80, 20, "–ü–µ—Ä–≤–æ–µ", "–æ–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è, –º–æ–ª–æ–∫–æ, –º–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ, —Å–∞—Ö–∞—Ä", "–ó–∞–≤—Ç—Ä–∞–∫", now),
    ("–û–º–ª–µ—Ç —Å —Å—ã—Ä–æ–º", 120, 15, "–í—Ç–æ—Ä–æ–µ", "—è–π—Ü–∞, –º–æ–ª–æ–∫–æ, —Å—ã—Ä, –º–∞—Å–ª–æ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ", "–ó–∞–≤—Ç—Ä–∞–∫", now),
    ("–°—ã—Ä–Ω–∏–∫–∏ —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π", 150, 12, "–í—Ç–æ—Ä–æ–µ", "—Ç–≤–æ—Ä–æ–≥, —è–π—Ü–∞, –º—É–∫–∞, —Å–∞—Ö–∞—Ä, —Å–º–µ—Ç–∞–Ω–∞", "–ó–∞–≤—Ç—Ä–∞–∫", now),
    ("–ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º", 30, 50, "–ù–∞–ø–∏—Ç–æ–∫", "—á–∞–π —á–µ—Ä–Ω—ã–π, –ª–∏–º–æ–Ω, —Å–∞—Ö–∞—Ä", "–ó–∞–≤—Ç—Ä–∞–∫", now),
    ("–ö–∞–∫–∞–æ", 60, 30, "–ù–∞–ø–∏—Ç–æ–∫", "–∫–∞–∫–∞–æ –ø–æ—Ä–æ—à–æ–∫, –º–æ–ª–æ–∫–æ, —Å–∞—Ö–∞—Ä", "–ó–∞–≤—Ç—Ä–∞–∫", now),

    # –û–±–µ–¥—ã
    ("–ë–æ—Ä—â —É–∫—Ä–∞–∏–Ω—Å–∫–∏–π", 180, 15, "–ü–µ—Ä–≤–æ–µ", "—Å–≤–µ–∫–ª–∞, –∫–∞–ø—É—Å—Ç–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –º–æ—Ä–∫–æ–≤—å, –ª—É–∫, –≥–æ–≤—è–¥–∏–Ω–∞, —Ç–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞", "–û–±–µ–¥",
     now),
    ("–°—É–ø –∫—É—Ä–∏–Ω—ã–π —Å –ª–∞–ø—à–æ–π", 150, 20, "–ü–µ—Ä–≤–æ–µ", "–∫—É—Ä–∏—Ü–∞, –ª–∞–ø—à–∞, –º–æ—Ä–∫–æ–≤—å, –ª—É–∫, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–û–±–µ–¥", now),
    ("–ö–æ—Ç–ª–µ—Ç–∞ —Å –ø—é—Ä–µ", 200, 12, "–í—Ç–æ—Ä–æ–µ", "–≥–æ–≤—è–¥–∏–Ω–∞, —Å–≤–∏–Ω–∏–Ω–∞, —Ö–ª–µ–±, —è–π—Ü–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –º–æ–ª–æ–∫–æ, –º–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ", "–û–±–µ–¥",
     now),
    ("–†—ã–±–∞ –∑–∞–ø–µ—á—ë–Ω–Ω–∞—è", 220, 8, "–í—Ç–æ—Ä–æ–µ", "—Ä—ã–±–∞, –ª–∏–º–æ–Ω, —Å–ø–µ—Ü–∏–∏, –º–∞—Å–ª–æ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ", "–û–±–µ–¥", now),
    ("–ü–ª–æ–≤ —É–∑–±–µ–∫—Å–∫–∏–π", 190, 10, "–í—Ç–æ—Ä–æ–µ", "—Ä–∏—Å, –±–∞—Ä–∞–Ω–∏–Ω–∞, –º–æ—Ä–∫–æ–≤—å, –ª—É–∫, —á–µ—Å–Ω–æ–∫, —Å–ø–µ—Ü–∏–∏", "–û–±–µ–¥", now),
    ("–°–∞–ª–∞—Ç –¶–µ–∑–∞—Ä—å", 120, 15, "–°–∞–ª–∞—Ç", "–∫—É—Ä–∏—Ü–∞, —Å–∞–ª–∞—Ç, –ø–æ–º–∏–¥–æ—Ä—ã, —Å—ã—Ä, —Å—É—Ö–∞—Ä–∏–∫–∏, —Å–æ—É—Å", "–û–±–µ–¥", now),
    ("–ö–æ–º–ø–æ—Ç –∏–∑ —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç–æ–≤", 50, 40, "–ù–∞–ø–∏—Ç–æ–∫", "—è–±–ª–æ–∫–∏ —Å—É—à–µ–Ω—ã–µ, –∫—É—Ä–∞–≥–∞, –∏–∑—é–º, —Å–∞—Ö–∞—Ä", "–û–±–µ–¥", now),
    ("–°–æ–∫ –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π", 70, 25, "–ù–∞–ø–∏—Ç–æ–∫", "–∞–ø–µ–ª—å—Å–∏–Ω—ã, —Å–∞—Ö–∞—Ä", "–û–±–µ–¥", now),
]

for dish in test_dishes:
    cursor.execute(
        "INSERT INTO menu (name, price, portions, type, ingredients, category, addedDate) VALUES (?,?,?,?,?,?,?)", dish)
    category_icon = "üåÖ" if dish[5] == "–ó–∞–≤—Ç—Ä–∞–∫" else "üçΩÔ∏è"
    print(f"‚úÖ –ë–ª—é–¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ: {dish[0]:25} {category_icon} {dish[5]:8} ({dish[1]}‚ÇΩ, {dish[2]} –ø–æ—Ä—Ü–∏–π)")

# ===== –ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ =====
ingredients = [
    ("–ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è", 50, "–∫–≥"),
    ("–°–∞—Ö–∞—Ä", 30, "–∫–≥"),
    ("–†–∏—Å", 40, "–∫–≥"),
    ("–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å", 100, "–∫–≥"),
    ("–ú—è—Å–æ (–≥–æ–≤—è–¥–∏–Ω–∞)", 20, "–∫–≥"),
    ("–ö—É—Ä–∏—Ü–∞", 25, "–∫–≥"),
    ("–ú–æ–ª–æ–∫–æ", 50, "–ª"),
    ("–Ø–π—Ü–∞", 200, "—à—Ç"),
]

for ing in ingredients:
    cursor.execute("INSERT INTO ingredients (name, amount, unit) VALUES (?,?,?)", ing)
    print(f"‚úÖ –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç: {ing[0]:20} ({ing[1]} {ing[2]})")

conn.commit()
conn.close()

print("\n" + "=" * 60)
print("‚úÖ –ë–ê–ó–ê –î–ê–ù–ù–´–• –ì–û–¢–û–í–ê!")
print("=" * 60)
print("\nüìã –¢–ï–°–¢–û–í–´–ï –ê–ö–ö–ê–£–ù–¢–´ (–ï–î–ò–ù–´–ô –ü–ê–†–û–õ–¨: 123):\n")
print("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê")
print("‚îÇ –õ–æ–≥–∏–Ω       ‚îÇ –ü–∞—Ä–æ–ª—å   ‚îÇ –†–æ–ª—å                       ‚îÇ")
print("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§")
print("‚îÇ a           ‚îÇ 123      ‚îÇ –£—á–µ–Ω–∏–∫ (9–ê, –±–∞–ª–∞–Ω—Å 1000‚ÇΩ) ‚îÇ")
print("‚îÇ aa          ‚îÇ 123      ‚îÇ –ü–æ–≤–∞—Ä (–æ–¥–æ–±—Ä–µ–Ω)            ‚îÇ")
print("‚îÇ aaa         ‚îÇ 123      ‚îÇ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä              ‚îÇ")
print("‚îÇ admin       ‚îÇ 123      ‚îÇ –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä    ‚îÇ")
print("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò")
print("\nüçΩÔ∏è  –í –º–µ–Ω—é –¥–æ–±–∞–≤–ª–µ–Ω–æ:", len(test_dishes), "–±–ª—é–¥ (–ó–∞–≤—Ç—Ä–∞–∫–∏ + –û–±–µ–¥—ã)")
print("üì¶  –ù–∞ —Å–∫–ª–∞–¥–µ:", len(ingredients), "–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤")
print("=" * 60)
print("\nüöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: python app.py")
print("üåê –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://127.0.0.1:8008")
print("=" * 60)